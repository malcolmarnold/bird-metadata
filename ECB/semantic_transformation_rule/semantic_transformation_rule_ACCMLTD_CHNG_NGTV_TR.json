{
  "semantic_transformation_rule_id" : "ACCMLTD_CHNG_NGTV_TR",
  "transformation_url" : "https://gitlab.sofa.dev/bird-subgroups/bird-transformation-rules/-/blob/main/FinRep%20subgroup/final%20derivation%20rules/ACCMLTD_CHNG_NGTV/infosheet.md",
  "type_of_transformation" : "D",
  "maintenance_agency_id" : "ECB",
  "name" : "Accumulated negative changes derivation rule",
  "code" : "ACCMLTD_CHNG_NGTV_TR",
  "description" : "This derivation rule aims to obtain the Accumulated negative changes from its building blocks.",
  "algorithm" : "SET ACCMLTD_CHNG_NGTV =\n    CASE\n        WHEN TKN_PSSSSN_DT > DATEADD(month,-3,DT_RFRNC)\n        AND TKN_PSSSSN_DT < DT_RFRNC\n        AND GRSS_CRRYNG_AMNT_INTL_RCGNTN - CRRYNG_AMNT < 0             \n        AND CLLTLR_RL_TYP = 1\n        AND (BLNC_SHT_RCGNSD_EXCHNG_TRDBL_DRVTV_ASST_PSTN_TKN_PSSSSN_TYP = 13\n        OR BLNC_SHT_RCGNSD_FNNCL_ASST_INSTRMNT_TKN_PSSSSN_TYP = 50 \n        OR LNG_SCRTY_PSTN_PRDNTL_PRTFL_ASSGNMNT_ACCNTNG_CLSSFCTN_FNNCL_ASSTS_ASSGNMNT_TKN_PSSSSN_TYP = 7)\n        THEN GRSS_CRRYNG_AMNT_INTL_RCGNTN - CRRYNG_AMNT\n        ELSE 'N/A'\n    END;",
  "valid_from" : "2024-02-28",
  "valid_to" : "9999-12-31",
  "logical_transformation_rule" : [ {
    "logical_transformation_rule_id" : "DER__BIRD_LNG_SCRTY_PSTN_PRDNTL_PRTFL_ASSGNMNT_ACCNTNG_CLSSFCTN_FNNCL_ASSTS_ASSGNMNT_EIL_1__ACCMLTD_CHNG_NGTV__01_01_1990",
    "semantic_transformation_rule_id" : "ACCMLTD_CHNG_NGTV_TR",
    "algorithm" : "SET BIRD_LNG_SCRTY_PSTN_PRDNTL_PRTFL_ASSGNMNT_ACCNTNG_CLSSFCTN_FNNCL_ASSTS_ASSGNMNT_EIL.ACCMLTD_CHNG_NGTV =\n        CASE\n            WHEN BIRD_LNG_SCRTY_PSTN_PRDNTL_PRTFL_ASSGNMNT_ACCNTNG_CLSSFCTN_FNNCL_ASSTS_ASSGNMNT_IL.LNG_SCRTY_PSTN_PRDNTL_PRTFL_ASSGNMNT_ACCNTNG_CLSSFCTN_FNNCL_ASSTS_ASSGNMNT_TKN_PSSSSN_TYP = 7\n               AND BIRD_LNG_SCRTY_PSTN_CLLTRL_RCVD_ASSGNMNT_IL.CLLTRL_RL_TYP = 1\n                AND BIRD_LNG_SCRTY_PSTN_PRDNTL_PRTFL_ASSGNMNT_ACCNTNG_CLSSFCTN_FNNCL_ASSTS_ASSGNMNT_IL.TKN_PSSSSN_DT > DATEADD(month,-3,BIRD_CLLTRL_IL.DT_RFRNC) \n                AND BIRD_LNG_SCRTY_PSTN_PRDNTL_PRTFL_ASSGNMNT_ACCNTNG_CLSSFCTN_FNNCL_ASSTS_ASSGNMNT_IL.TKN_PSSSSN_DT < BIRD_LNG_SCRTY_PSTN_PRDNTL_PRTFL_ASSGNMNT_ACCNTNG_CLSSFCTN_FNNCL_ASSTS_ASSGNMNT_IL.DT_RFRNC\n                AND BIRD_LNG_SCRTY_PSTN_PRDNTL_PRTFL_ASSGNMNT_ACCNTNG_CLSSFCTN_FNNCL_ASSTS_ASSGNMNT_IL.GRSS_CRRYNG_AMNT_INTL_RCGNTN - BIRD_LNG_SCRTY_PSTN_PRDNTL_PRTFL_ASSGNMNT_ACCNTNG_CLSSFCTN_FNNCL_ASSTS_ASSGNMNT_IL.CRRYNG_AMNT < 0 \n                THEN BIRD_LNG_SCRTY_PSTN_PRDNTL_PRTFL_ASSGNMNT_ACCNTNG_CLSSFCTN_FNNCL_ASSTS_ASSGNMNT_IL.GRSS_CRRYNG_AMNT_INTL_RCGNTN - BIRD_LNG_SCRTY_PSTN_PRDNTL_PRTFL_ASSGNMNT_ACCNTNG_CLSSFCTN_FNNCL_ASSTS_ASSGNMNT_IL.CRRYNG_AMNT\n            ELSE 'N/A'\n        END;",
    "additional_filters" : null,
    "source_layer" : "IL",
    "destination_layer" : "EIL",
    "transformation_type" : "DER",
    "valid_from" : "1990-01-01",
    "valid_to" : "9999-12-31"
  }, {
    "logical_transformation_rule_id" : "DER__BIRD_EXCHNG_TRDBL_DRVTV_PSTN_RL_EIL_1__ACCMLTD_CHNG_NGTV__01_01_1990",
    "semantic_transformation_rule_id" : "ACCMLTD_CHNG_NGTV_TR",
    "algorithm" : "SET BIRD_EXCHNG_TRDBL_DRVTV_PSTN_RL_EIL.ACCMLTD_CHNG_NGTV =\n        CASE\n            WHEN BIRD_EXCHNG_TRDBL_DRVTV_PSTN_RL_IL.BLNC_SHT_RCGNSD_EXCHNG_TRDBL_DRVTV_ASST_PSTN_TKN_PSSSSN_TYP = 13\n                AND BIRD_ASST_PL_CLLTRL_RCVD_ASSGNMNT_IL.CLLTRL_RL_TYP = 1\n                AND BIRD_EXCHNG_TRDBL_DRVTV_PSTN_RL_IL.TKN_PSSSSN_DT > DATEADD(month,-3,BIRD_CLLTRL_IL.DT_RFRNC) \n                AND BIRD_EXCHNG_TRDBL_DRVTV_PSTN_RL_IL.TKN_PSSSSN_DT < BIRD_EXCHNG_TRDBL_DRVTV_PSTN_RL_IL.DT_RFRNC\n                AND BIRD_EXCHNG_TRDBL_DRVTV_PSTN_RL_IL.GRSS_CRRYNG_AMNT_INTL_RCGNTN - BIRD_EXCHNG_TRDBL_DRVTV_PSTN_RL_IL.CRRYNG_AMNT < 0 \n                THEN BIRD_EXCHNG_TRDBL_DRVTV_PSTN_RL_IL.GRSS_CRRYNG_AMNT_INTL_RCGNTN - BIRD_EXCHNG_TRDBL_DRVTV_PSTN_RL_IL.CRRYNG_AMNT\n            ELSE 'N/A'\n        END;",
    "additional_filters" : null,
    "source_layer" : "IL",
    "destination_layer" : "EIL",
    "transformation_type" : "DER",
    "valid_from" : "1990-01-01",
    "valid_to" : "9999-12-31"
  }, {
    "logical_transformation_rule_id" : "DER__BIRD_INSTRMNT_RL_EIL_1__ACCMLTD_CHNG_NGTV__01_01_1990",
    "semantic_transformation_rule_id" : "ACCMLTD_CHNG_NGTV_TR",
    "algorithm" : "SET BIRD_INSTRMNT_RL_EIL.ACCMLTD_CHNG_NGTV =\n        CASE\n            WHEN BIRD_INSTRMNT_RL_IL.BLNC_SHT_RCGNSD_FNNCL_ASST_INSTRMNT_TKN_PSSSSN_TYP = 50\n                AND BIRD_INSTRMNT_CLLTRL_ASSGNMNT_IL.CLLTRL_RL_TYP = 1\n                AND BIRD_INSTRMNT_RL_IL.TKN_PSSSSN_DT > DATEADD(month,-3,BIRD_CLLTRL_IL.DT_RFRNC) \n                AND BIRD_INSTRMNT_RL_IL.TKN_PSSSSN_DT < BIRD_INSTRMNT_RL_IL.DT_RFRNC\n                AND BIRD_INSTRMNT_RL_IL.GRSS_CRRYNG_AMNT_INTL_RCGNTN - BIRD_INSTRMNT_RL_IL.CRRYNG_AMNT < 0 \n                THEN BIRD_INSTRMNT_RL_IL.GRSS_CRRYNG_AMNT_INTL_RCGNTN - BIRD_INSTRMNT_RL_IL.CRRYNG_AMNT\n            ELSE 'N/A'\n        END;",
    "additional_filters" : null,
    "source_layer" : "IL",
    "destination_layer" : "EIL",
    "transformation_type" : "DER",
    "valid_from" : "1990-01-01",
    "valid_to" : "9999-12-31"
  } ]
}