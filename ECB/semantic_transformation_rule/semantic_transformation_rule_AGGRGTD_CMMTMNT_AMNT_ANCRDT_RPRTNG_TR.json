{
  "semantic_transformation_rule_id" : "AGGRGTD_CMMTMNT_AMNT_ANCRDT_RPRTNG_TR",
  "transformation_url" : "https://gitlab.sofa.dev/bird-subgroups/bird-transformation-rules/-/blob/main/AnaCredit%20Subgroup/Derivation%20rules%20-%20Final/AGGRGTD_CMMTMNT_AMNT_ANCRDT_RPRTNG/infosheet.md",
  "type_of_transformation" : "D",
  "maintenance_agency_id" : "ECB",
  "name" : "Aggregated commitment amount for Anacredit reporting derivation rule",
  "code" : "AGGRGTD_CMMTMNT_AMNT_ANCRDT_RPRTNG_TR",
  "description" : "This derivation rule aims to obtain the Aggregated commitment amount for Anacredit reporting from its building blocks.",
  "algorithm" : "SET BIRD_ENTTY_RL_EIL.AGGRGTD_CMMTMNT_AMNT_ANCRDT_RPRTNG =\nCASE\n    WHEN BIRD_PRTY_IL.PRTY_TYP NOT IN (18, 19)\n    THEN\n        (\n            SELECT SUM(BIRD_INSTRMNT_IL.NMNL_AMNT + BIRD_INSTRMNT_IL.OFF_BLNC_SHT_AMNT)\n            FROM BIRD_INSTRMNT_IL\n            WHERE BIRD_INSTRMNT_IL.INSTRMNT_ID IN (\n                      SELECT BIRD_INSTRMNT_RL_IL.INSTRMNT_ID\n                      FROM BIRD_INSTRMNT_RL_IL\n                      WHERE BIRD_INSTRMNT_RL_IL.INSTRMNT_RL_TYP IN (34, 35)\n                  )\n              AND (\n                    (BIRD_INSTRMNT_IL.INSTRMNT_TYP_PRDCT = 80\n                          AND BIRD_INSTRMNT_IL.INSTRMNT_ID IN (\n                          SELECT BIRD_INSTRMNT_ENTTY_RL_ASSGNMNT_IL.INSTRMNT_ID\n                          FROM BIRD_INSTRMNT_ENTTY_RL_ASSGNMNT_IL\n                          WHERE BIRD_INSTRMNT_ENTTY_RL_ASSGNMNT_IL.PRTY_ID = BIRD_PRTY_IL.PRTY_ID\n                            AND BIRD_INSTRMNT_ENTTY_RL_ASSGNMNT_IL.PRTY_RL_TYP = 4\n                            AND BIRD_INSTRMNT_ENTTY_RL_ASSGNMNT_IL.INSTRMNT_ENTTY_RL_ASSGNMNT_TYP = 24\n                                                \n                   )\n                  )\n                  OR  \n                    (BIRD_INSTRMNT_IL.INSTRMNT_TYP_PRDCT = 1020\n                          AND BIRD_INSTRMNT_IL.INSTRMNT_ID IN (\n                          SELECT BIRD_INSTRMNT_ENTTY_RL_ASSGNMNT_IL.INSTRMNT_ID\n                          FROM BIRD_INSTRMNT_ENTTY_RL_ASSGNMNT_IL\n                          WHERE BIRD_INSTRMNT_ENTTY_RL_ASSGNMNT_IL.PRTY_ID = BIRD_PRTY_IL.PRTY_ID\n                            AND BIRD_INSTRMNT_ENTTY_RL_ASSGNMNT_IL.PRTY_RL_TYP = 4\n                            AND BIRD_INSTRMNT_ENTTY_RL_ASSGNMNT_IL.INSTRMNT_ENTTY_RL_ASSGNMNT_TYP = 20\n                                                \n                   )\n                  )\n                                                              \n                    OR\n                    (BIRD_INSTRMNT_IL.INSTRMNT_TYP_PRDCT IN = 1022\n                     AND BIRD_INSTRMNT_IL.INSTRMNT_ID IN (\n                          SELECT BIRD_INSTRMNT_ENTTY_RL_ASSGNMNT_IL.INSTRMNT_ID\n                          FROM BIRD_INSTRMNT_ENTTY_RL_ASSGNMNT_IL\n                          WHERE BIRD_INSTRMNT_ENTTY_RL_ASSGNMNT_IL.PRTY_ID = BIRD_PRTY_IL.PRTY_ID\n                            AND BIRD_INSTRMNT_ENTTY_RL_ASSGNMNT_IL.PRTY_RL_TYP = 28\n                            AND BIRD_INSTRMNT_ENTTY_RL_ASSGNMNT_IL.INSTRMNT_ENTTY_RL_ASSGNMNT_TYP = 6\n                     )\n                    )\n                    OR\n                     (BIRD_INSTRMNT_IL.INSTRMNT_TYP_PRDCT = 1023\n                     AND BIRD_INSTRMNT_IL.INSTRMNT_ID IN (\n                          SELECT BIRD_INSTRMNT_ENTTY_RL_ASSGNMNT_IL.INSTRMNT_ID\n                          FROM BIRD_INSTRMNT_ENTTY_RL_ASSGNMNT_IL\n                          WHERE BIRD_INSTRMNT_ENTTY_RL_ASSGNMNT_IL.PRTY_ID = BIRD_PRTY_IL.PRTY_ID\n                            AND BIRD_INSTRMNT_ENTTY_RL_ASSGNMNT_IL.PRTY_RL_TYP = 4\n                            AND BIRD_INSTRMNT_ENTTY_RL_ASSGNMNT_IL.INSTRMNT_ENTTY_RL_ASSGNMNT_TYP = 20\n                     )\n                    )\n                    OR\n                     (BIRD_INSTRMNT_IL.INSTRMNT_TYP_PRDCT = 51\n                     AND BIRD_INSTRMNT_IL.INSTRMNT_ID IN (\n                          SELECT BIRD_INSTRMNT_ENTTY_RL_ASSGNMNT_IL.INSTRMNT_ID\n                          FROM BIRD_INSTRMNT_ENTTY_RL_ASSGNMNT_IL\n                          WHERE BIRD_INSTRMNT_ENTTY_RL_ASSGNMNT_IL.PRTY_ID = BIRD_PRTY_IL.PRTY_ID\n                            AND BIRD_INSTRMNT_ENTTY_RL_ASSGNMNT_IL.PRTY_RL_TYP = 28\n                            AND BIRD_INSTRMNT_ENTTY_RL_ASSGNMNT_IL.INSTRMNT_ENTTY_RL_ASSGNMNT_TYP = 17\n                     )\n                    )\n                    OR\n                    \n                    (BIRD_INSTRMNT_IL.INSTRMNT_TYP_PRDCT = 511\n                     AND BIRD_INSTRMNT_IL.OVRDRFT_INDCTR = 1\n                     AND BIRD_INSTRMNT_IL.INSTRMNT_ID IN (\n                          SELECT BIRD_INSTRMNT_ENTTY_RL_ASSGNMNT_IL.INSTRMNT_ID\n                          FROM BIRD_INSTRMNT_ENTTY_RL_ASSGNMNT_IL\n                          WHERE BIRD_INSTRMNT_ENTTY_RL_ASSGNMNT_IL.PRTY_ID = BIRD_PRTY_IL.PRTY_ID\n                            AND BIRD_INSTRMNT_ENTTY_RL_ASSGNMNT_IL.PRTY_RL_TYP = 18\n                            AND BIRD_INSTRMNT_ENTTY_RL_ASSGNMNT_IL.INSTRMNT_ENTTY_RL_ASSGNMNT_TYP = 15\n                     )\n                    )\n                    \n                    OR\n                    (BIRD_INSTRMNT_IL.INSTRMNT_TYP_PRDCT = 1003\n                     AND BIRD_INSTRMNT_IL.INSTRMNT_ID IN (\n                          SELECT BIRD_INSTRMNT_ENTTY_RL_ASSGNMNT_IL.INSTRMNT_ID\n                          FROM BIRD_INSTRMNT_ENTTY_RL_ASSGNMNT_IL\n                          WHERE BIRD_INSTRMNT_ENTTY_RL_ASSGNMNT_IL.PRTY_ID = BIRD_PRTY_IL.PRTY_ID\n                            AND BIRD_INSTRMNT_ENTTY_RL_ASSGNMNT_IL.PRTY_RL_TYP = 28\n                            AND BIRD_INSTRMNT_ENTTY_RL_ASSGNMNT_IL.INSTRMNT_ENTTY_RL_ASSGNMNT_TYP = 26\n                     )\n                    )\n              )\n        )\nEND;",
  "valid_from" : "2025-11-15",
  "valid_to" : "9999-12-31",
  "logical_transformation_rule" : [ {
    "logical_transformation_rule_id" : "DER__BIRD_ENTTY_RL_EIL_1__AGGRGTD_CMMTMNT_AMNT_ANCRDT_RPRTNG__01_01_1990",
    "semantic_transformation_rule_id" : "AGGRGTD_CMMTMNT_AMNT_ANCRDT_RPRTNG_TR",
    "algorithm" : "SET BIRD_ENTTY_RL_EIL.AGGRGTD_CMMTMNT_AMNT_ANCRDT_RPRTNG =\nCASE\n    WHEN BIRD_PRTY_IL.PRTY_TYP NOT IN (18, 19)\n    THEN\n        (\n            SELECT SUM(BIRD_INSTRMNT_IL.NMNL_AMNT + BIRD_INSTRMNT_IL.OFF_BLNC_SHT_AMNT)\n            FROM BIRD_INSTRMNT_IL\n            WHERE BIRD_INSTRMNT_IL.INSTRMNT_ID IN (\n                      SELECT BIRD_INSTRMNT_RL_IL.INSTRMNT_ID\n                      FROM BIRD_INSTRMNT_RL_IL\n                      WHERE BIRD_INSTRMNT_RL_IL.INSTRMNT_RL_TYP IN (34, 35)\n                  )\n              AND (\n                    (BIRD_INSTRMNT_IL.INSTRMNT_TYP_PRDCT = 80\n                          AND BIRD_INSTRMNT_IL.INSTRMNT_ID IN (\n                          SELECT BIRD_INSTRMNT_ENTTY_RL_ASSGNMNT_IL.INSTRMNT_ID\n                          FROM BIRD_INSTRMNT_ENTTY_RL_ASSGNMNT_IL\n                          WHERE BIRD_INSTRMNT_ENTTY_RL_ASSGNMNT_IL.PRTY_ID = BIRD_PRTY_IL.PRTY_ID\n                            AND BIRD_INSTRMNT_ENTTY_RL_ASSGNMNT_IL.PRTY_RL_TYP = 4\n                            AND BIRD_INSTRMNT_ENTTY_RL_ASSGNMNT_IL.INSTRMNT_ENTTY_RL_ASSGNMNT_TYP = 24\n                                                \n                   )\n                  )\n                  OR  \n                    (BIRD_INSTRMNT_IL.INSTRMNT_TYP_PRDCT = 1020\n                          AND BIRD_INSTRMNT_IL.INSTRMNT_ID IN (\n                          SELECT BIRD_INSTRMNT_ENTTY_RL_ASSGNMNT_IL.INSTRMNT_ID\n                          FROM BIRD_INSTRMNT_ENTTY_RL_ASSGNMNT_IL\n                          WHERE BIRD_INSTRMNT_ENTTY_RL_ASSGNMNT_IL.PRTY_ID = BIRD_PRTY_IL.PRTY_ID\n                            AND BIRD_INSTRMNT_ENTTY_RL_ASSGNMNT_IL.PRTY_RL_TYP = 4\n                            AND BIRD_INSTRMNT_ENTTY_RL_ASSGNMNT_IL.INSTRMNT_ENTTY_RL_ASSGNMNT_TYP = 20\n                                                \n                   )\n                  )\n                                                              \n                    OR\n                    (BIRD_INSTRMNT_IL.INSTRMNT_TYP_PRDCT IN = 1022\n                     AND BIRD_INSTRMNT_IL.INSTRMNT_ID IN (\n                          SELECT BIRD_INSTRMNT_ENTTY_RL_ASSGNMNT_IL.INSTRMNT_ID\n                          FROM BIRD_INSTRMNT_ENTTY_RL_ASSGNMNT_IL\n                          WHERE BIRD_INSTRMNT_ENTTY_RL_ASSGNMNT_IL.PRTY_ID = BIRD_PRTY_IL.PRTY_ID\n                            AND BIRD_INSTRMNT_ENTTY_RL_ASSGNMNT_IL.PRTY_RL_TYP = 28\n                            AND BIRD_INSTRMNT_ENTTY_RL_ASSGNMNT_IL.INSTRMNT_ENTTY_RL_ASSGNMNT_TYP = 6\n                     )\n                    )\n                    OR\n                     (BIRD_INSTRMNT_IL.INSTRMNT_TYP_PRDCT = 1023\n                     AND BIRD_INSTRMNT_IL.INSTRMNT_ID IN (\n                          SELECT BIRD_INSTRMNT_ENTTY_RL_ASSGNMNT_IL.INSTRMNT_ID\n                          FROM BIRD_INSTRMNT_ENTTY_RL_ASSGNMNT_IL\n                          WHERE BIRD_INSTRMNT_ENTTY_RL_ASSGNMNT_IL.PRTY_ID = BIRD_PRTY_IL.PRTY_ID\n                            AND BIRD_INSTRMNT_ENTTY_RL_ASSGNMNT_IL.PRTY_RL_TYP = 4\n                            AND BIRD_INSTRMNT_ENTTY_RL_ASSGNMNT_IL.INSTRMNT_ENTTY_RL_ASSGNMNT_TYP = 20\n                     )\n                    )\n                    OR\n                     (BIRD_INSTRMNT_IL.INSTRMNT_TYP_PRDCT = 51\n                     AND BIRD_INSTRMNT_IL.INSTRMNT_ID IN (\n                          SELECT BIRD_INSTRMNT_ENTTY_RL_ASSGNMNT_IL.INSTRMNT_ID\n                          FROM BIRD_INSTRMNT_ENTTY_RL_ASSGNMNT_IL\n                          WHERE BIRD_INSTRMNT_ENTTY_RL_ASSGNMNT_IL.PRTY_ID = BIRD_PRTY_IL.PRTY_ID\n                            AND BIRD_INSTRMNT_ENTTY_RL_ASSGNMNT_IL.PRTY_RL_TYP = 28\n                            AND BIRD_INSTRMNT_ENTTY_RL_ASSGNMNT_IL.INSTRMNT_ENTTY_RL_ASSGNMNT_TYP = 17\n                     )\n                    )\n                    OR\n                    \n                    (BIRD_INSTRMNT_IL.INSTRMNT_TYP_PRDCT = 511\n                     AND BIRD_INSTRMNT_IL.OVRDRFT_INDCTR = 1\n                     AND BIRD_INSTRMNT_IL.INSTRMNT_ID IN (\n                          SELECT BIRD_INSTRMNT_ENTTY_RL_ASSGNMNT_IL.INSTRMNT_ID\n                          FROM BIRD_INSTRMNT_ENTTY_RL_ASSGNMNT_IL\n                          WHERE BIRD_INSTRMNT_ENTTY_RL_ASSGNMNT_IL.PRTY_ID = BIRD_PRTY_IL.PRTY_ID\n                            AND BIRD_INSTRMNT_ENTTY_RL_ASSGNMNT_IL.PRTY_RL_TYP = 18\n                            AND BIRD_INSTRMNT_ENTTY_RL_ASSGNMNT_IL.INSTRMNT_ENTTY_RL_ASSGNMNT_TYP = 15\n                     )\n                    )\n                    \n                    OR\n                    (BIRD_INSTRMNT_IL.INSTRMNT_TYP_PRDCT = 1003\n                     AND BIRD_INSTRMNT_IL.INSTRMNT_ID IN (\n                          SELECT BIRD_INSTRMNT_ENTTY_RL_ASSGNMNT_IL.INSTRMNT_ID\n                          FROM BIRD_INSTRMNT_ENTTY_RL_ASSGNMNT_IL\n                          WHERE BIRD_INSTRMNT_ENTTY_RL_ASSGNMNT_IL.PRTY_ID = BIRD_PRTY_IL.PRTY_ID\n                            AND BIRD_INSTRMNT_ENTTY_RL_ASSGNMNT_IL.PRTY_RL_TYP = 28\n                            AND BIRD_INSTRMNT_ENTTY_RL_ASSGNMNT_IL.INSTRMNT_ENTTY_RL_ASSGNMNT_TYP = 26\n                     )\n                    )\n              )\n        )\nEND;",
    "additional_filters" : null,
    "source_layer" : "IL",
    "destination_layer" : "EIL",
    "transformation_type" : null,
    "valid_from" : "1990-01-01",
    "valid_to" : "9999-12-31"
  } ]
}